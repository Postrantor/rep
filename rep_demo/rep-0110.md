---
tip: translate by openai@2023-06-07 22:13:05
...

REP: 110 Title: SCM-like rosinstall command structure Author: Thibault Kruse \<<kruset@in.tum.de>\> Status: Draft Type: Informational Content-Type: text/x-rst Created: 11-Jun-2011 Post-History: 11-Jun-2011, 10-Aug-2011, 03-Mar-2012

> 回复：110 标题：类似SCM的rosinstall命令结构 作者：Thibault Kruse \<<kruset@in.tum.de>\> 状态：草案 类型：信息内容类型：text/x-rst 创建日期：2011年6月11日 后续历史：2011年6月11日，2011年8月10日，2012年3月3日

# Table of Contents

1. [Abstract](#abstract)
2. [Specification](#specification)
3. [Use-cases](#Use-cases)
4. [Analysis](#Analysis)
5. [Rationale](#rationale)
6. [Motivation](#motivation)
7. [Compatibility](#Compatibility)
8. [Design-Alternatives](#Design-Alternatives)
9. [Reference-implementation](#Reference-implementation)
10. [References](#references)
11. [Copyright](#copyright)

# Abstract {#Abstract}


This REP presents an alternative to the rosinstall[^1] command-line interface to a command-based syntax. The command-based syntax is inspired by SCM tools like `svn`, `git`, and `hg` as well as several other ros commands like rosnode or rosservice, and is intended to improve the usability of rosinstall as well as expose more functionality. Common use cases of rosinstall are described and compared with the proposed changes.

> 这个REP提出了一个替代rosinstall[^1]命令行界面的基于命令的语法。基于命令的语法受到如`svn`、`git`和`hg`等SCM工具以及其他一些ros命令（如rosnode或rosservice）的启发，旨在提高rosinstall的可用性，并暴露更多功能。描述了rosinstall的常见用例，并与拟议的更改进行了比较。

# Specification {#Specification}

## Command-line syntax


The name \"rosinstall\" does not fit into an SCM like tool as it contains a verb \"install\" in its name, which is confusing. The name rosws for rosworkspace is a suggestion based also on other activities around rosinstall. (see [https://code.ros.org/lurker/message/20110711.160222.666ecfe4.en.html](https://code.ros.org/lurker/message/20110711.160222.666ecfe4.en.html))

> 名称“rosinstall”不适合作为一种SCM（软件配置管理）工具，因为它的名字中包含动词“install”，这会令人困惑。建议将rosinstall改名为rosws（rosworkspace），这也是基于围绕rosinstall的其他活动（参见[https://code.ros.org/lurker/message/20110711.160222.666ecfe4.en.html](https://code.ros.org/lurker/message/20110711.160222.666ecfe4.en.html)）。


The command by default uses the context to determine which folder to use as target of the operations. Two location types are relevant, the workspace folder, and folders of entries.

> 命令默认使用上下文来确定哪个文件夹作为操作的目标。两种位置类型是相关的，工作区文件夹和条目文件夹。


The workspace folder must contain a .rosinstall file to be recognized as such. The rosws command will consider the first such folder in the chain of the current directory and its parents. The rosinstall command may also rely on the ROS_WORKSPACE environment variable to specify a workspace. If both approaches detect a suitable folder, the command will fail with an error message indicating the ambiguity. The user may specify a target workspace folder with the same option for all commands. This is the preferred approach for scripting with rosws.

> 工作空间文件夹必须包含一个.rosinstall文件才能被认可。rosws命令将考虑当前目录及其父目录链中的第一个这样的文件夹。rosinstall命令也可能依赖ROS_WORKSPACE环境变量来指定工作空间。如果两种方法都检测到合适的文件夹，该命令将失败，并显示指示歧义的错误消息。用户可以使用相同的选项为所有命令指定目标工作空间文件夹。这是与rosws脚本相关的首选方法。


To determine what entry a user wants to work on for certain commands, the concept of a localname is used in what follows. The localname is historically an absolute filepath or a relative path relative to the workspace folder. Commands which accept a localname argument will first attempt to resolve that argument against the list of known localnames. If that fails, the commands will fall back to choosing a workspace entry which has the same path in the filesystem, even if the localname does not match. As an example, `rosws diff .` In a tree with localname `foo` is equivalent to `rosws diff foo`. Finally, some commands may fall back to interpret such an argument, if it is the only one, and in the absence of a specifying option, as a workspace folder if the command also accepts a workspace folder.

> 为了确定用户要处理哪个条目，在接下来的操作中使用了本地名称的概念。本地名称历史上是绝对文件路径或相对于工作区文件夹的相对路径。接受本地名称参数的命令将首先尝试根据已知的本地名称解析该参数。如果失败，命令将回退到选择具有相同文件系统路径的工作区条目，即使本地名称不匹配也是如此。例如，在具有本地名称“foo”的树中，`rosws diff .`等效于`rosws diff foo`。最后，如果只有一个参数，且在没有指定选项的情况下，一些命令也可能回退到解释这样一个参数，如果命令也接受工作区文件夹，则将其解释为工作区文件夹。

### rosws init \[PATH \[URI\]\] {#init}


The command creates an initial environment for the other commands to work. This is analogous to scm syntax. Its main purpose is to explain the tool to the user, who understands that the location used here is going to be a special location further on.

> 命令为其他命令创建一个初始环境。这类似于scm语法。它的主要目的是向用户解释工具，用户理解这里使用的位置将在以后是一个特殊的位置。


The command also generates three initial files, setup.sh, setup.bash and setup.zsh, which when sourced set up environment variables according to the .rosinstall file in the same folder. Those files wll only be overwritten by the `rosws regenerate` command.

> 命令还会生成三个初始文件：setup.sh，setup.bash和setup.zsh，当源文件被设置时，根据同一文件夹中的.rosinstall文件设置环境变量。这些文件只有在使用`rosws regenerate`命令时才会被覆盖。

`--catkin`, `--cmake-prefix-path`

> Options retain semantics as in rosinstall

### rosws merge \[URI\] {#merge}

This command processes several entries from a given URI source


The command merges new entries (command line or changed in `.rosinstall`) with existing entries (if a `.rosinstall` is present). The strategy is to replace existing entries rather than adding whenever possible. This is the case when an existing and a new entry have the same target path, the same SCM type, and a similar SCM configuration (e.g. same URI root).

> 命令将新条目（命令行或在`.rosinstall`中更改）与现有条目（如果存在`.rosinstall`）合并。策略是尽可能替换现有条目而不是添加。当现有条目和新条目具有相同的目标路径、相同的SCM类型和类似的SCM配置（例如相同的URI根）时，这就是情况。

The strategy fails whenever there are two entries with the same target path but replacing is impossible with the strategy above.

When successfull, the command will append the new entries to the end of the `.rosinstall` file.

URI can be a path to a rosinstall file, to a local directory containing a `.rosinstall`.

The command will fail when there are entries with duplicate target paths.


The command calculates the change to the configuration. If the change merely consists of adding entries, this is executed. Else, the user is presented with an overview of planned changes, roughly similar to what the linux aptitude tool may present. The user can then interrupt the operation. An option exists to not ask for confirmation.

> 命令计算配置的变化。如果变化仅仅包括添加条目，则会执行。否则，用户会看到一个计划变更的概览，大致类似于Linux aptitude工具可能显示的内容。然后，用户可以中断操作。还有一个选项可以不用询问确认。

Options:

The merge options apply whenever two elements have equivalent localnames (pointing to the same directory)

\--merge-keep

:   Existing entries will remain unchanged

\--merge-replace

:   Existing entries will be overwritten in place

\--merge-kill-append

:   Exiting entries will be removed, new ones appended to the end

\--confirm-all

:   Do not ask for confirmation

`-`

:   A single dash can be used for piping stdout into the merge command

### rosws set \[LOCALNAME\] \[URI\]? {#set}


The command serves to add or modify a single entry of the config and is in particular aimed at users entering the entry information themselves rather than relying on some other source of information.

> 命令旨在添加或修改配置的单个条目，特别针对那些自己输入条目信息而不是依赖其他信息来源的用户。

For adding an entry, the common case is to add an SCM entry. The syntax would then be

rosws set localname uri \--scmtype \--version=version

Options:


\--svn Subversion SCM \--hg Mercurial SCM \--git git SCM \--bzr bazaar SCM \--tar tar as source (unofficial experimental feature) \--detached no SCM \--version-new the version specification to use

> --svn Subversion 版本控制系统 --hg Mercurial 版本控制系统 --git git 版本控制系统 --bzr bazaar 版本控制系统 --tar tar 作为源（非官方实验特性） --detached 无版本控制系统 --version-new 要使用的版本规范

`-` single dash means read from stdin (similar to tar command)

Option `-version` would go against the GNU standard of a global \--version option giving the version of a command line tool.

Examples:

```
$ rosws set robot_model --hg https://kforge.ros.org/robotmodel/robot_model
$ rosws set robot_model --version robot_model-1.7.1
$ rosws set robot_model --detached
```

### rosws update \[LOCALNAME\]\* {#update}

The command checks out or updates the given subtrees or all subtrees from their respective SCM provider and URL.


\--continue-on-error Continue despite checkout errors \--delete-changed-uris Delete the local copy of a directory before changing uri. \--abort-changed-uris Abort if changed uri detected \--backup-changed-uris=BACKUP_CHANGED backup the local copy of a directory before changing uri to this directory.

> --继续出错：继续尽管出现检出错误 --删除改变的 URI：在更改 URI 之前删除本地目录的副本 --中止改变的 URI：如果检测到改变的 URI，则中止 --备份改变的 URI=BACKUP_CHANGED：在更改 URI 之前，将本地目录的副本备份到此目录中。

Options retain their semantics from current rosinstall.

Examples:

```
$ rosws update -t ~/fuerte
$ rosws update robot_model geometry
```

### rosws info \[LOCALNAME\]\* {#info}


This serves to explain the current environment to the novice user, and provide an overview of it. It is supposed to give an overview of the environment and its state. The reference implementation lists the interpreted `ROS_ROOT` and the ordered paths in the `ROS_PACKAGE_PATH`. It also provides status information about the local directories, such as whether they exist and whether their current version matches the `.rosinstall`.

> 这有助于向新手用户解释当前环境，并提供其概述。它应该提供环境及其状态的概览。参考实现列出解释的`ROS_ROOT`和`ROS_PACKAGE_PATH`中的有序路径。它还提供有关本地目录的状态信息，例如它们是否存在以及它们的当前版本是否与`.rosinstall`匹配。

Options:


\--data-only just the data, no headers or text \--no-pkg-path does not print ROS_PACKAGE_PATH \--pkg-path-only Shows only ROS_PACKAGE_PATH separated by `:`. Supercedes all other options. \--only Shows only given comma-separated attribute(s) separated by `,` \--yaml prints rosinstall format yaml for backing up the current config

> \--data-only 只有数据，没有标题或文本 \--no-pkg-path 不打印ROS_PACKAGE_PATH \--pkg-path-only 仅显示以':'分隔的ROS_PACKAGE_PATH，优先于其他选项 \--only 仅显示由','分隔的给定属性 \--yaml 打印rosinstall格式的yaml以备份当前配置

These options are mainly intended to allow scripting based on rosinstall.

Examples:

```
$ rosws info -t ~/ros/fuerte
$ rosws info robot_model
$ rosws info --yaml
$ rosws info --only=path,cur_uri,cur_revision robot_model geometry
```

### rosws remove \[LOCALNAME\]+ {#remove}

removes entries with given localnames from the .rosinstall file

### rosws status \[LOCALNAME\]\* {#status}

This command batch-calls SCM status. The output is the concatenation status commands for all versioned entries.

Options:

\--untracked also shows untracked files

### rosws diff \[LOCALNAME\]\* {#diff}

This command batch-calls SCM diffs. The output is the concatenation of diff commands for all versioned entries.


Such a feature was suggested on ros-developers. The reference implementation shows how this could be done. However the solution is neither very robust nor flexible for SCM diff options.

> 这个功能在ros-developers上被提议。参考实现展示了如何做到这一点。然而，这个解决方案对SCM diff选项来说既不是很健壮也不是很灵活。


There is room for ambiguity when the version specified in the `.rosinstall` does not match the version in the directory. A warning should be given on stderr at least.

> 当`.rosinstall`中指定的版本与目录中的版本不匹配时，存在歧义。至少应在stderr上给出警告。

### rosws regenerate {#regenerate}


This command regenerates the setup.sh, setup.bash and setup.zsh files that setup a shell environment. The rosinstall command overwrites these files on each invocation for historical reasons.

> 这个命令重新生成setup.sh，setup.bash和setup.zsh文件，用于设置shell环境。出于历史原因，rosinstall命令每次调用时都会覆盖这些文件。


There is as of today no need to regenerate these files even if the .rosinstall file changed in acceptable use-cases. The only cases where the files would be changed is when configuring a workspace against a changed ROS distribution, or after an update of the rosws tool.

> 至今，即使在可接受的使用案例中.rosinstall文件发生了变化，也没有必要重新生成这些文件。唯一可能导致文件变化的情况是，当配置对改变的ROS发行版的工作区时，或者在更新rosws工具后。

Options

\--catkin \--cmake-prefix-path

Options retain semantics as in rosinstall

# Analysis

## Use cases {#Use-cases}

The following are a list of use cases for rosinstall. U1-U6 are based on use cases described in the rosinstall documentation[^2].

The new command syntax examples usually have several alternatives to use context or options to specify the workspace to operate on..

### U1: Create a new environment based on an existing ros installation {#U1}

E.g. Developing on top of boxturtle shared install

`rosinstall ~/workspace /opt/ros/boxturtle http://www.ros.org/rosinstalls/wg_boxturtle_devel.rosinstall`

New command example:

```
rosws ~/workspace /opt/ros/boxturtle
cd ~/workspace
rosws merge  http://www.ros.org/rosinstalls/wg_boxturtle_devel.rosinstall
rosws update
```

### U2: Create a new environment based on a rosinstall file only {#U2}

E.g. Full source checkout

`rosinstall ~/workspace http://www.ros.org/rosinstalls/boxturtle_pr2all.rosinstall`

New command example:

```
rosws ~/workspace http://www.ros.org/rosinstalls/boxturtle_pr2all.rosinstall
```

### U3: Create a new environment with an additional stack {#U3}

E.g. Developing a stack against a full tree

`rosinstall ~/workspace http://www.ros.org/rosinstalls/boxturtle_pr2all.rosinstall my_stack.rosinstall`

New command example:

```
rosws ~/workspace http://www.ros.org/rosinstalls/boxturtle_pr2all.rosinstall
cd ~/workspace
rosws merge my_stack.rosinstall
rosws update
```

### U4: Adding more entries to an existing workspace {#U4}

E.g. Adding a rosinstall layout to an existing workspace

`rosinstall ~/workspace http://www.ros.org/rosinstalls/wg_boxturtle_devel.rosinstall`

New command example:

```
cd ~/workspace
rosws merge http://www.ros.org/rosinstalls/wg_boxturtle_devel.rosinstall
rosws update
```

### U5: Updating a rosinstall tree {#U5}

`rosinstall ~/workspace`

New command example:

```
cd ~/workspace
rosws update sometree
```

### U6: Changing the version of a specific stack {#U6}

You can manually edit the file `.rosinstall` in a rosinstall managed workspace and then call `rosinstall ~/workspace`.

New command example:

```
cd ~/workspace
rosws set stackname --version=newversion
```

### U7: Overlaying a released ROS package with the sources {#U7}

e.g. taking the sources from trunk, using `roslocate`

`roslocate info common_msgs | rosinstall add .`

New command example:

```
cd ~/workspace
roslocate info common_msgs | rosws merge -
```

### U8: Rearranging the order of entries in the `ROS_PACKAGE_PATH` {#U8}

You can manually edit the file `.rosinstall` in a rosinstall managed workspace and then call `rosinstall ~/workspace`

### U9: Removing directories from the `ROS_PACKAGE_PATH` {#U9}

You can manually edit the file `.rosinstall` in a rosinstall managed workspace and then call `rosinstall ~/workspace`

New command example:

```
cd ~/workspace
rosws remove foo
```

### U10: Checking the validity of the current ROS environment {#U10}

using diverse file exploration tools

### U11: Creating a snapshot of the configuration {#U11}

`rosinstall ~/workspace --generate-versioned-rosinstall=GENERATE_VERSIONED`

New command example:

```
cd ~/workspace
rosws info --yaml > GENERATE_VERSIONED
```

### U12: Modifying the current configuration according to a snapshot {#U12}

same as [U4](#U4)

### U13: Basing the environment on a different `ROS_ROOT` {#U13}

Users should generall avoid doing this, as it can lead to failure in many ways.

Therefore not implementing the usecase in this REP, meaning user has to manually modify `.rosinstall` and call rosinstall

### U14: Create a new environment based on an existing one {#U14}

`rosinstall ~/workspace /path/to/other/workspace`

New command example:

```
rosws init ~/workspace /path/to/other/workspace
```

### U15: Moving a local stack to a different location {#U15}


The user has some ROS stack in directory foo, and want to move that stack to directory bar. This means moving the files as well as updating the `.rosinstall` and the `setup.sh`.

> 用户在目录foo中有一些ROS堆栈，并希望将该堆栈移动到目录bar。这意味着移动文件以及更新`.rosinstall`和`setup.sh`。

Will not be supported for now.

### U16: User makes arbitrary changes to .rosinstall {#U16}


An expert user can change path, version, scm, entry order, etc. in his rosinstall. In some cases he then just wants his `setup.sh` file to be regenerated, in other cases he may want to update directories to specific revisions.

> 一位专家用户可以在他的rosinstall中更改路径、版本、scm、入口顺序等。在某些情况下，他只想重新生成`setup.sh`文件，在其他情况下，他可能想将目录更新到特定的版本。

`rosinstall ~/workspace`

New command example:

```
cd ~/workspace
rosws update foostack
rosws regenerate
```

### U17: User wants to see combined diff {#U17}

When the user works on several interdependent stacks, he wants to create a unified diff of those stacks against their checked-out revision.

`rosinstall ~/workspace --diff`

New command example:

```
cd ~/workspace
rosws diff
```

### U18: User wants to status of scm files {#U18}

When the user works on several interdependent stacks, he wants to see what files are currently in a changed status in their respective SCM.

`rosinstall ~/workspace --status`

New command example:

```
cd ~/workspace
rosws status
```

## Use-case analysis {#Analysis}


All rosinstall use-cases deal with a user trying to maintain a ROS environment on a local machine. A ROS environment means the assignment of values to `ROS_PACKAGE_PATH`, `PATH`, `PYTHONPATH` and `ROS_MASTER_URI`, as well as further changes to support ROS toolchains.

> 所有rosinstall用例都涉及用户试图在本地机器上维护ROS环境。ROS环境意味着将值分配给`ROS_PACKAGE_PATH`、`PATH`、`PYTHONPATH`和`ROS_MASTER_URI`，以及进一步更改以支持ROS工具链。

Given the description, a user of rosinstall needs to be aware of the following artifacts:

- any `.rosinstall` file in the current directory
- the setup.\* files in the current directory
- the state of local directories
- the information contained in other rosinstall files


As a user is free to manipulate entry in the configuration files, a major cause for errors are mistakes during such modifications. As an automated tool, rosinstall currently only knows of this: The user may have changed the rosinstall file, the user may have provided additional locations, now a new `.rosinstall` file may have to be merged with additional locations, and new setup.\* files have to be generated.

> 作为用户可以自由操作配置文件的入口，错误的主要原因是在此类修改过程中的错误。作为一个自动化工具，rosinstall目前只知道这些：用户可能已经更改了rosinstall文件，用户可能提供了额外的位置，现在可能需要将新的`.rosinstall`文件与额外的位置合并，并生成新的setup.\*文件。


An early attempt for this REP tried to provide different commands for different use-cases, such as `init`, `remove`, `add` and `update`. However the code for all those commands had in all cases to remain largely similar to cope with the situation where a user had manually changed his or her `.rosinstall`, or filesystem.

> 一个早期的尝试为这个REP提供不同的命令用于不同的用例，例如`init`、`remove`、`add`和`update`。然而，为了应对用户手动更改其`.rosinstall`或文件系统的情况，这些命令的代码在所有情况下都必须大致相似。


The list of use-cases thus only displays the range of distinctive usages of rosinstall, but does not provide help into splitting up the main functionality into many small commands.

> 列出的用例只展示了rosinstall的不同用法范围，但没有提供将主要功能分解成许多小命令的帮助。

## T1: Table of use cases and commands


+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+-----------------+-------------+---------------+-------------------+---------------+-------------------+-------------------+

> +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+-----------------+-------------+---------------+-------------------+---------------+-------------------+-------------------+

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+-----------------+-------------+---------------+-------------------+---------------+-------------------+-------------------+

简化中文
| UC                                                                                                                                                                                        | [init](#init) | [merge](#merge) | [set](#set) | [info](#info) | [update](#update) | [diff](#diff) | [status](#status) | [remove](#remove) |

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

> +===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+

+===========================================================================================================================================================================================+===============+=================+=============+===============+===================+===============+===================+===================+
| [U1](#U1) [U2](#U2) [U3](#U3) [U4](#U4) [U5](#U5) [U6](#U6) [U7](#U7) [U8](#U8) [U9](#U9) [U10](#U10) [U11](#U11) [U12](#U12) [U14](#U14) [U15](#U15) [U16](#U16) [U17](#U17) [U18](#U18) | > x x x       | > x             | > x         | > x           | > x               | > x           | > x               | > x               |
|                                                                                                                                                                                           |               | >               |             |               | >                 |               |                   |                   |
|                                                                                                                                                                                           |               | > x x           |             |               | > x x x x x       |               |                   |                   |
|                                                                                                                                                                                           |               | >               |             |               | >                 |               |                   |                   |
|                                                                                                                                                                                           |               | > x             |             |               | > x x             |               |                   |                   |
|                                                                                                                                                                                           |               | >               |             |               | >                 |               |                   |                   |
|                                                                                                                                                                                           |               | > x x           |             |               | > x               |               |                   |                   |

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+-----------------+-------------+---------------+-------------------+---------------+-------------------+-------------------+

> +-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+-----------------+-------------+---------------+-------------------+---------------+-------------------+-------------------+

+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+-----------------+-------------+---------------+-------------------+---------------+-------------------+-------------------+

简化中文

# Motivation {#Motivation}


The rosinstall tool, while useful, has a command-line syntax that can be difficult for beginners of ROS to become familiar with. Users who are intimidated by rosinstall can resort to manually creating source trees and maintaining `ROS_PACKAGE_PATH` by hand. Improving the usability of the rosinstall tool can improve the ROS experience for beginner users as well as introduce advanced users to more powerful features.

> rosinstall 工具虽然有用，但其命令行语法对ROS的初学者来说可能很难理解。如果被rosinstall吓到的用户，可以手动创建源树并手动维护`ROS_PACKAGE_PATH`。改善rosinstall工具的可用性可以改善初学者的ROS体验，同时也可以让高级用户接触到更强大的功能。

# Rationale {#Rationale}

The extended command structure allows to perform a broader range of operations concerning multiple SCMs, and mere investigative commands.

Breaking down functionality helps self-explaining of the tool.

Also this makes it easier to extend rosinstall with other functions, and to use rosintall in scripts (e.g. provide a curses/tk-based rosinstall ui).


Another problem are the `--options`. Those are only required in specific use-cases, but in the current solution the user may provide them in any case, and thus the user will have difficulties to tell what his choices for options are, given his intention. Having distinct commands allows a help function to quickly tell the user what options are available for his specific intention.

> 另一个问题是`--options`。 这些只在特定的使用场景中需要，但在当前的解决方案中，用户可以在任何情况下提供它们，因此用户将很难判断出根据其意图所具有的选项。 拥有明确的命令可以让帮助功能快速告知用户特定意图的可用选项。

The SCM like structure also allows code completion to provide command choices, which is a significant help for users when learning a new tool.


The vision of the source code is that it will one day in large parts be moved out of rosinstall to provide ROS-independent functionality for managing directories of mutliple SCMs. However the rosinstall functionality of generating setup files for ROS environments will remain important. Therefore a name change to rosws is suggested rather than a ROS-independent name.

> 资源代码的愿景是，有一天它的很大一部分将从rosinstall中移出，为管理多个SCM目录提供与ROS无关的功能。但是，生成ROS环境设置文件的rosinstall功能仍然很重要。因此，建议采用rosws而不是ROS独立的名称来更改名称。

## Names

The current rosinstall command structure allows a command such as:

```
rosinstall ~/workspace /opt/ros/diamondback ~/workspace2 ~/workspace/foo ~/download/temp.rosinstall
```


The intention of the user typing this cannot be inferred from the command, nor can what the tool will do be inferred from the syntax. The key idea is to have a syntax that allows the user to express a specific intention and to understand what the tool will do.

> 用户输入这条命令时的意图无法从命令中推断出来，也无法从语法中推断工具将会做什么。关键的想法是拥有一种语法，让用户能够表达特定的意图，并且理解工具将会做什么。

The commands `info`, `diff`, and `status` are self-explanatory.


The word `install` was dropped completely with the broad functionality it offers in rosinstall. `install` makes users shy away from usage fearing they might corrupt their debian installation with a tool.

> 该单词“安装”在rosinstall中完全被舍弃，因为它提供的功能很强大。“安装”让用户害怕会用这个工具损坏他们的Debian安装，从而不敢使用它。


The `set` and `merge` commands are somewhat ambiguous, as the user would need to use them for multiple purposes of adding entries or modifying versions of entries. However the different use-cases are algorithmically so similar that own commands for each seem superflous.

> `set`和`merge`命令有些模糊，因为用户需要用它们来添加条目或修改条目版本。然而，不同的用例在算法上是如此相似，以至于为每个用例设计自己的命令似乎是多余的。

Rejected names include:

add, edit, modify, read, load, import, change

# Backwards Compatibility {#Compatibility}

The rosinstall setup files remain unchanged.

Current rosinstall syntax is:

```
Usage: rosinstall PATH [<options> ...] [URI]...

Options:
  --version             show program's version number and exit
  -h, --help            show this help message and exit
  -n, --nobuild         skip the build step for the ROS stack
  --rosdep-yes          Pass through --rosdep-yes to rosmake
  --continue-on-error   Continue despite checkout errors
  --delete-changed-uris
                        Delete the local copy of a directory before changing
                        uri.
  --abort-changed-uris  Abort if changed uri detected
  --backup-changed-uris=BACKUP_CHANGED
                        backup the local copy of a directory before changing
                        uri to this directory.
  --generate-versioned-rosinstall=GENERATE_VERSIONED
                        generate a versioned rosintall file
```

`--generate-versioned-rosinstall` is a special case and is replaced by `rosinstall snapshot`.

This will be fulfilled by `rosws install`.

The change in command syntax impacts rosinstall based tools such as the new proposal for a rosworkspace.

# Design Alternatives {#Design-Alternatives}

## rosinstall0.5

As originally developed by Tully Foote.

Commands are:

```
rosinstall PATH [options] [URIs]
```


with a 4 Phase model, Merging, Checking out, Generating setup, bootstrapping ROS serving most use-cases and `--generate-versioned-rosinstall` being an exceptional command

> 使用4个阶段模型，合并、检查、生成设置、引导ROS，满足大多数用例，而`--generate-versioned-rosinstall`是一个特殊的命令。

## Extended-options

Similar to the commands provided in the REP, some of the functionality could be provided by additional `--options`.

e.g.:

```
rosinstall --info
rosinstall --check
rosinstall --diff
rosinstall --status
```

This is less useful for bash completion and focused help.

## SCM-like-explicit-path

As initially suggested for this REP, all commands require the path on which to work as the first argument.

Commands are:

```
rosinstall <command> PATH [options]
rosinstall <command> PATH [options] [URIs]
```


The SCM-like Designs are in line with the other ROS tools. However, SCM tools usually drop the `PATH` argument and work in the current directory tree.

> 跟其他ROS工具相一致，SCM式设计也是如此。但是，SCM工具通常会放弃`PATH`参数，并在当前目录树中运行。

## SCM-like-implicit-path


Inferring the path from context can be done to varying degrees, like ignoring the ROS_WORKSPACE variable or only considering the current folder, not its ancestors as candidates.

> 从上下文推断路径可以以不同程度实现，比如忽略ROS_WORKSPACE变量，或者只考虑当前文件夹，而不是其祖先作为候选。


Another alternative is to try first interpreting any first argument as a workspace folder, however this may conflict with the syntax of command `set`.

> 另一种选择是首先尝试将任何第一个参数解释为工作区文件夹，但这可能会与命令`set`的语法冲突。

## SCM-like-extended-command-set


The install command suggested provides support for several use cases which could be further split up into different commands, e.g. `add` and `apply`. See [Rejects](#rejects).

> 安装命令建议提供支持几种用例，可以进一步拆分为不同的命令，例如`add`和`apply`。详见[拒绝](#rejects)。

# Reference implementation {#Reference-implementation}

Reference implementation is provided with the latest rosinstall release.

# Rejects {#Rejects}

Ideas for rosinstall commands that were dropped for this REP, but may become interesting later:

## 2nd draft rejects


In 2012 there was a second surge to realize the REP. In this it was decided to make a more significant step away from the rosinstall design. As a consequence, certain ideas were brought up and rejected:

> 2012年，发生了第二次突破，以实现REP。在此，决定要进一步远离rosinstall设计。因此，提出并拒绝了某些想法。

- rosws install: replicates rosinstall


A command doing many things at once confuses and scares the occasional user Similarly commands set, merge nad update only do one thing, and do not allow doing more than one thing.

> 命令一次做很多事情会让偶尔使用者感到困惑和害怕。同样，命令设置、合并和更新只做一件事，不允许做多于一件事情。

- update after set/merge


It could be convenient if the tool did or offered to checkout/update tree entries after a set/merge operation. This can be added as an option in the future if users want it.

> 如果工具在合并操作后提供检出/更新树条目的功能，将会很方便。如果用户需要，这可以作为未来的一个选项添加。

- many uris for init and merge


These commands could technically take many uri arguments instead of maximally one. The decision to allow only one is to help users understand the syntax. The problem with many arguments we saw with rosinstall is that users could not read from the syntax whether the second argument had a special semantic or not, or whether the order of the arguments mattered.

> 这些命令本质上可以接受多个URI参数，而不是最多一个。允许只有一个参数的决定是为了帮助用户理解语法。我们在rosinstall中看到的许多参数的问题是，用户无法从语法中读取第二个参数是否具有特殊语义，或者参数的顺序是否重要。

- Maintain rosinstall assumptions about ROS


rosinstall was provided in support of early ROS releases, this REP is provided in the wake of ROS fuerte, which makes significant changes to how a ROS environment is set up. rosws can have a fresh start with fuerte only providing minimal support for ealier distros. In particular rosws will not insist on having a ROS stack, and will not build ros or ros_comm even after source checkouts, nor have an option to do so. A future development could be to even drop generation of the setup.\* files.

> rosinstall 曾被提供以支持早期的ROS版本，而在ROS fuerte的面前，REP 提供了重大的改变，以便于ROS环境的设置。 rosws 将只以fuerte提供最小的支持，而不再支持早期的发行版本。特别是rosws不再坚持ROS堆栈，即使在源代码检出后也不会构建ros或ros_comm，也没有选择这样做的选项。未来的发展可能是甚至不再生成setup.\*文件。

- optional localname when adding using `set`


With SCM providers, it is possible to checkout a new local copy from a url without giving a target folder name. The same could be achieved with the rosws set syntax. However this makes the syntax more confusing, and in many cases we want the user to be aware of names because the repository names often have dashes where the localname should have underscores.

> 通过SCM提供商，可以从URL检出新的本地副本，而无需提供目标文件夹名称。使用rosws set语法也可以实现相同的功能。但是，这使得语法更加复杂，在许多情况下，我们希望用户意识到名称，因为存储库名称通常有破折号，而本地名称应该有下划线。

- rosws snapthos

The command is just a variant of rosws info and can be a \--option

- making `set` and `merge` a single command


Both commands add/modify entries, so the case was made to unify them. It was rejected after lengthy discussions for these reasons: There is the fact that the 1st argument is mandatory for set, but not useful as localname for merge. There are the different \-- options for the different cases. For the user, it should be clear whether his focus is some \"remote\" resource containing a set of many yaml entries, or on a single entry to add/change. That split is also the split of commands. The user won\'t be surprised by tab completion options `--hg` (or just `hg` as positional argument) or \--version when merging with rosinstall files. They would make no sense, but code completion cannot know that. The localnames wont get in the way of tab completion user when wanting to point to a local xyz.rosinstall file. It is true that merge is semantically like n calls to set, except it is an atomic operation (all succeed, or all fail). In the far future, we might think of nested workspaces having state and version of their own and defining commit() and add()and update() actions. Then we could have a different type for the \"set\" command, BUT this would be very different semantics from the merge command, and the merge command would not become obsolete. This possibility should also indicate why merging the `set` and `merge` command above would hinder things in the future.

> 两个命令都可以添加/修改条目，因此为了统一它们而提出了这个案例。但是，在长时间的讨论之后，该案例被拒绝了，原因如下：首先，对于set命令，第一个参数是必需的，但是在merge中不是有用的本地名称。其次，不同情况下有不同的\--选项。对于用户来说，他们应该清楚自己的焦点是某个包含许多yaml条目的“远程”资源，还是一个要添加/更改的单个条目。这种分裂也是命令的分裂。当用户想指向本地xyz.rosinstall文件时，他们不会因为本地名称而感到惊讶。事实上，merge在语义上类似于n次调用set，但它是一个原子操作（全部成功，或全部失败）。在将来的某一天，我们可能会考虑嵌套的工作空间具有自己的状态和版本，并定义commit（），add（）和update（）操作。然后我们可以为“set”命令定义不同的类型，但这与merge命令的语义大不相同，merge命令不会过时。这种可能性也表明，为什么在将来会妨碍将“set”和“merge”命令合并。

- making all entry arguments in `set` mandatory


The `set` semantics could be cleaner if it followed the principle that always a full entry (scmtype, uri, version) must be provided. This is however unnecessarily tedious when the user just wants to change one of the details of an existing entry

> 如果`set`语义遵循一个原则，即必须提供完整的条目（scmtype、uri、版本），那么它将变得更加清晰。然而，当用户只想更改现有条目的其中一个细节时，这会变得不必要地繁琐。

- splitting `set` into `add` and `edit`


The split has the advantage that more warnings can be provided in case the user tries to add an entry which overlaps another. However a confirmation step is sufficient. Also this would allow having mandatory positional parameters for scmtype and uri in the add case, and optional ones for the edit case, but two different syntax structures for very similar cases would be confusing as well.

> 分割有一个优势，就是如果用户试图添加一个重叠的条目，可以提供更多的警告。但是一个确认步骤就足够了。此外，这也会允许在添加情况下为scmtype和uri强制使用位置参数，而在编辑情况下使用可选参数，但是两种类似情况的不同语法结构可能也会令人困惑。

- making the scmtype in `set` a positional argument

positional arguments like hg, git and svn do not work well with an optional third positional argument URI.

- detach as a command of its own


`set` has option \--detached to remove all scm information. The case was made to make this a command of its own, in particular for a fuse set/merge command. But it fits better with the set - merge split.

> `set`有一个选项`--detached`，用于删除所有SCM信息。为了使这成为一个单独的命令，特别是用于fuse set/merge命令，案例被制定。但它更适合set - merge分割。

- `remove` as a `set` option


removal is an instance of modifying, so it could be unified with set as a \--option. However the end effect of a `set` operation is always that something exists afterwards, so these semantics get muddied by remove as an option.

> 移除是修改的一种实例，因此可以将它与设置统一为一个选项。但是，设置操作的最终效果总是会有某些东西存在，因此将移除作为一个选项会模糊这些语义。

- default merge option killAppend


When using `merge` or `set`, a decision is when an overlapping entry exist, whether to replace it in place, or whether to remove the existing and append the new one at the end. rosinstall has the latter semantic because it conveniently implies that it is possible to ensure an ordering of entries in the config file by ordering them in the argument list.

> 当使用`merge`或`set`时，一个决定是当存在重叠条目时，是替换它，还是删除现有的并在末尾追加新的。rosinstall具有后者的语义，因为它方便地意味着可以通过在参数列表中对它们进行排序来确保配置文件中的条目排序。


For novice users however this behavior is confusing and also hard to describe. The default semantics for merge is therefore to replace the entry in place. An option exists for merge to change that behavior.

> 对于新手用户，这种行为很令人困惑，也很难描述。因此，合并的默认语义是替换原有的条目。合并也有选项可以改变这种行为。

## 1st draft rejects

The following attempts were rejected in the first REP draft in 2011

- rosws regenerate: Generates setup files but does not attempt to update SCM based entries
- rosws init: first time command demands a ROS root to be specified. too similar to install
- rosws update: merges new entries and runs update on all scm based entries. too similar to install
- rosws remove: removes an entry from .rosinstall. Better be done by hand

In the second draft, those command were resurrected in particular in the absence of an all encompassing rosws install command.


Those commands were too similar to rosws install and their behavior to bulk update and regenerate all trees conflicted with the semantics sugested by their name.

> 这些命令太类似于rosws安装，它们的行为批量更新和重新生成所有树与其名称所暗示的语义冲突。

- rosws overlay: looks up repository location based on roslocate and rosinstalls it
- rosws change-ros: allows to move from e.g. /opt/ros/diamondback to \~/ros or /opt/ros/cturtle
- rosws mv: Moves local checked out stack to different location on filesystem
- rosws reorder: changes the order of stacks in `ROS_PACKAGE_PATH`
- rosws change-version: changes the desired version of an SCM based local stack
- rosws check \--repair: Attempts to (interactively) fix inconsistencies such as duplicate paths

Those commands make the initial version of the REP more complex to discuss and harder to implement, therefore they were left out.

# References {#References}

# Copyright {#Copyright}


Copyright (c) 2011 by Thibault Kruse. This material may be distributed only subject to the terms and conditions set forth in the Open Publication License, v0.1 or later (the latest version is presently available at [http://www.opencontent.org/openpub/](http://www.opencontent.org/openpub/)).

> 版权所有 (c) 2011 Thibault Kruse。本材料只受开放出版许可证，v0.1或更高版本 (最新版本目前可在[http://www.opencontent.org/openpub/](http://www.opencontent.org/openpub/)获得) 中规定的条款和条件的限制而发布。

[^1]: rosinstall ([http://www.ros.org/wiki/rosinstall](http://www.ros.org/wiki/rosinstall))


[^2]: rosinstall ([http://www.ros.org/wiki/rosinstall](http://www.ros.org/wiki/rosinstall))
