---
tip: translate by openai@2023-06-08 10:03:03
...

REP: 2008 Title: ROS 2 Hardware Acceleration Architecture and Conventions Author: Víctor Mayoral-Vilches \<<victor@accelerationrobotics.com>\> Status: Draft Type: Standards Track Content-Type: text/x-rst Created: 10-Aug-2021 Post-History: 12-October-2022

> 回复：2008 标题：ROS 2 硬件加速架构和约定 作者：Víctor Mayoral-Vilches <<victor@accelerationrobotics.com>> 状态：草案 类型：标准跟踪内容类型：text/x-rst 创建日期：2021 年 8 月 10 日 发布历史：2022 年 10 月 12 日

# Abstract


This REP describes the architectural pillars and conventions required to introduce hardware acceleration in ROS 2 in a vendor-neutral, scalable and technology-agnostic manner.

> 这份报告描述了以厂商中立、可扩展和技术无关的方式在ROS 2中引入硬件加速所需的架构支柱和约定。

# Motivation


With the decline of Moore's Law, hardware acceleration has proven itself as the answer for achieving higher performance gains in robotics[^1]. CPUs are widely used in the ROS 2 ecosystem due to their availability however they hardly provide real-time and safety guarantees while delivering high throughput. Hardware acceleration with accelerators like FPGAs, GPUs, DPUs or TPUs present an answer to this problem. One that allows the robotics architect to create custom computing architectures for robots that comply with real-time and throughput requirements simultaneously, while increasing the performance-per-watt and saving energy.

> 随着摩尔定律的衰退，硬件加速已经证明是实现机器人性能收益的答案[^1]。由于可用性，CPU在ROS 2生态系统中广泛使用，但是在提供高吞吐量的同时几乎不能提供实时和安全保证。FPGA，GPU，DPU或TPU等加速器提供了解决这个问题的答案。它允许机器人架构师创建符合实时和吞吐量要求的定制计算架构，同时提高性能/功率比和节省能源。

> From a systems architecture perspective, hardware acceleration helps create specialized compute architectures that rely on specific hardware accelerators which empower faster robots, with reduced computation times (*real fast*, as opposed to *real-time*), lower power consumption and more deterministic behaviours[^3]. The core idea is that instead of following the traditional CPU control-driven approach for software development in robotics, a mixed control- and data-driven one with accelerators allows to design custom compute architectures that further exploit parallelism in robotic algorithms. This is a paradigm shift that requires a change in the way we think about robotics software development and the way we design and architect robotic systems.


Hardware acceleration can revolutionize ROS 2 computations, enabling new applications by speeding up robot response times while remaining power-efficient. However, *the diversity of acceleration options* (FPGAs, GPUs, DPUs or TPUs, among many other accelerators) *makes it difficult for roboticists to easily deploy accelerated systems without expertise in each specific accelerator platform*. To address this problem, this REP provides a reference architecture and a series of conventions to integrate in the ROS 2 ecosystem accelerators and hardware acceleration external frameworks, tools and libraries that facilitate creating parallel compute architectures.

> 硬件加速可以彻底改变ROS 2计算，通过加快机器人响应时间同时保持高效的功耗，实现新的应用。然而，加速选项的多样性（FPGA、GPU、DPU或TPU等众多加速器）使机器人科学家难以在没有每个特定加速器平台专业知识的情况下轻松部署加速系统。为了解决这个问题，本REP提供了一个参考架构和一系列约定，以便将加速器和硬件加速外部框架、工具和库集成到ROS 2生态系统中，从而便于创建并行计算架构。

**The purpose of this REP is thereby to provide standard guidelines on how to use hardware acceleration in combination with ROS 2**. These guidelines are realized in the form of a series of ROS 2 packages that implement an open architecture and abstract away these external resources providing a vendor-neutral, Operating System (OS) and technology-agnostic ROS 2-centric development experience for hardware acceleration. The proposed open architecture also allows for the integration of external frameworks, tools and libraries, so that changing from one accelerator to another becomes trivial. This REP also recommends a methodology for developing ROS 2 packages that integrate hardware acceleration which can help developers guide their efforts. **This REP does not aim to dictate policy on which OS, frameworks or languages shall be used to create acceleration kernels, nor it aims to abstract away from these technologies**. This decision is left to the architect building the acceleration. For example, the use of OpenCL, CUDA, Vulkan, HLS, Halide, Exo, etc. is beyond the scope of this REP and often attached to the specific accelerator in-use, as each silicon vendor supports only certain technologies. What this REP provides is an entry point for developers to define their own acceleration kernels, integrate them into ROS 2 applications and if appropriate, command the ROS 2 build system to build such accelerators.


To do so, the architecture proposed extends the ROS 2 build system (`ament`), optionally extends the ROS 2 build tools (`colcon`) and adds a new firmware pillar to simplify the production and deployment of acceleration kernels. The architecture is agnostic to the computing target (i.e. considers support for edge, workstation, data center or cloud targets), OS and technology-agnostic (considers initial support for FPGAs and GPUs), application-agnostic and modular, which enhances portability to new accelerators across silicon vendors. The core components of the architecture are implemented and open sourced under an Apache 2.0 license, and maintained at the [ROS 2 Hardware Acceleration Working Group GitHub organization](https://github.com/ros-acceleration/).

> 为此，提出的架构扩展了ROS 2构建系统（“ament”），可选地扩展了ROS 2构建工具（“colcon”），并添加了一个新的固件支柱，以简化加速内核的生产和部署。该架构对计算目标（即考虑支持边缘、工作站、数据中心或云端目标）、操作系统和技术无关（考虑初始支持FPGA和GPU）、应用无关且模块化，从而增强了跨硅片供应商到新加速器的可移植性。该架构的核心组件在Apache 2.0许可证下实现和开源，并在[ROS 2硬件加速工作组GitHub组织](https://github.com/ros-acceleration/)上进行维护。

::: {#stakeholders}
Value for stakeholders:
:::


- Package maintainers can use these guidelines to integrate hardware acceleration capabilities in their ROS 2 packages in an accelerator-agnostic manner.

> 维护者可以使用这些指南以硬件加速功能为基础，以与加速器无关的方式集成到他们的ROS 2 包中。

- Consumers can use the guidelines in the REP, as well as the corresponding benchmarks of each accelerator (if available), to set expectations on the hardware acceleration capabilities, *ease of use* and scalability that could be obtained from each vendor\'s hardware acceleration solution.

> 消费者可以根据REP中的指南，以及每个加速器的相应基准（如果可用），来设定从每个供应商的硬件加速解决方案中可以获得的硬件加速能力、*使用便利性*和可扩展性的期望。

- Silicon vendors, OS suppliers and hardware solution manufacturers can use these guidelines to connect their accelerators and firmware (including frameworks, tools and libraries) to the ROS 2 ecosystem. By doing so, they will obtain direct support for hardware acceleration in all ROS 2 packages that support it.

> 供应商、操作系统供应商和硬件解决方案制造商可以利用这些指导原则将其加速器和固件（包括框架、工具和库）连接到ROS 2生态系统中。通过这样做，他们将获得对支持硬件加速的所有ROS 2软件包的直接支持。


The outcome of this REP should be that maintainers who want to leverage hardware acceleration in their packages, can do so with consistent guidelines and with support across multiple hardware acceleration technologies (FPGAs and GPUs initially, but extending towards more accelerators in the future) by following the conventions set. This way, maintainers will be able to create ROS 2 packages with support for hardware acceleration that can run across accelerators. In turn, as silicon vendors add support for their technologies and accelerators, ROS 2 packages aligned with this REP will automatically gain support for these new accelerators.

> 结果应该是，想要在自己的包中利用硬件加速的维护者，可以遵循一致的指南，并在多种硬件加速技术（最初是FPGA和GPU，但在未来可以延伸到更多加速器）上获得支持。这样，维护者就可以创建支持硬件加速的ROS 2包，并可以在加速器上运行。反过来，随着硅片厂商添加对其自己技术和加速器的支持，符合本REP的ROS 2包将自动获得对这些新加速器的支持。


The guidelines in here provide a ROS 2-centric open architecture for hardware acceleration, which silicon vendors can decide to adopt when engaging with the ROS 2 community.

> 这里的指南提供了一种以ROS 2为中心的开放式架构，硅片供应商可以在与ROS 2社区互动时选择采用它。

## Antigoals

The motivation behind this REP does **not** include:


- Dictating policy implementation specifics on maintainers to achieve hardware acceleration and/or create acceleration kernels (e.g use of CUDA, HLS, OpenCL, or similar)

> 对维护者规定政策实施的具体细节以实现硬件加速和/或创建加速内核（例如使用CUDA、HLS、OpenCL或类似技术）

  - Policy requirements about which framework to use (e.g. ROCm, JetPack, etc.) or which specific C++ preprocessor instructions are *intentionally generic* and to remain technology-agnostic.

> 要求政策关于使用哪个框架（例如ROCm、JetPack等）或哪些特定的C++预处理指令是有意的通用的，并保持技术无关性。

  - Maintainers can come up with their own policies depending on the technology targeted (FPGAs, GPUs, etc.) and framework used (`HLS`, `ROCm`, `CUDA`, etc).

> 维护者可以根据针对的技术（FPGA、GPU等）和使用的框架（HLS、ROCm、CUDA等）制定自己的政策。
- Enforcing specific hardware solutions on maintainers
  - No maintainer is required to target any specific hardware solution by any of the guidelines in this REP.

  - Instead, maintainers are free to choose from either using the proposed generic CMake macros meant to support all accelerators (e.g. `acceleration_kernel` ), or instead use vendor-specific CMake extensions for particular supported technologies and hardware solutions (e.g. `vitis_acceleration_kernel` ).

> 取而代之，维护者可以从使用旨在支持所有加速器的拟议的通用CMake宏（例如`acceleration_kernel`）或使用特定于供应商的特定支持技术和硬件解决方案的CMake扩展（例如`vitis_acceleration_kernel`）中任选一个。
- Excluding any supported ROS 2 OS.

## Kernel levels in ROS 2 {#Kernel Levels}


To favour modularity, organize acceleration kernels and allow robotics architects to select only those accelerators needed to meet the requirements of their application, acceleration kernels in ROS 2 shall be classified in 3 levels according to the ROS layer/underlayer they impact:

> 为了支持模块化，组织加速内核，并允许机器人架构师仅选择满足其应用程序要求的加速器，ROS 2 中的加速内核将根据其影响的 ROS 层/底层分为3个级别：

::: {#Level I kernels}


- *Level 1* - **ROS 2 applications and libraries**: This group corresponds with acceleration kernels that speed-up OSI L7 applications or libraries on top of ROS 2. Any computation on top of ROS 2 is a good a candidate for this category. Examples include selected components in the navigation, manipulation, perception or control stacks.

> - *第1级* - **ROS 2应用程序和库**：此组对应于在ROS 2之上加速OSI L7应用程序或库的加速内核。在ROS 2之上的任何计算都是此类别的好候选项。例子包括导航，操作，感知或控制堆栈中的选定组件。
  :::

::: {#Level II kernels}


- *Level 2* - **ROS 2 core packages**: This includes kernels that accelerate or offload OSI L7 ROS 2 core components and tools to a dedicated acceleration solution (e.g. an FPGA). Namely, we consider `rclcpp`, `rcl`, `rmw`, and the corresponding `rmw_adapters` for each supported communication middleware. Examples includes ROS 2 executors for more deterministic behaviours[^4], or complete hardware offloaded ROS 2 Nodes[^5].

> - *第二级* - **ROS 2 核心包**：这包括加速或将OSI L7 ROS 2核心组件和工具卸载到专用加速解决方案（例如FPGA）的内核。具体而言，我们考虑`rclcpp`、`rcl`、`rmw`以及每个支持的通信中间件的相应`rmw_adapters`。例子包括ROS 2执行器，以获得更确定性的行为[^4]，或完整的硬件卸载ROS 2节点[^5]。
  :::

::: {#Level III kernels}


- *Level 3* - **ROS 2 underlayers**: Groups together all accelerators below the ROS 2 core layers belonging to OSI L2-L7, including the communication middleware (e.g. DDS). Examples of such accelerators include a complete or partial DDS implementation, an offloaded networking stack or a data link layer for real-time deterministic, low latency and high throughput interactions.

> - *第三级* - **ROS 2 底层**：将属于OSI L2-L7的ROS 2核心层下的所有加速器组合在一起，包括通信中间件（例如DDS）。这样的加速器的例子包括完整或部分的DDS实现，卸载网络堆栈或实时确定性、低延迟和高吞吐量交互的数据链路层。
  :::

Hardware acceleration solutions complying with this REP should aspire to support multiple kernel levels in ROS 2 to maximize consumer experience.

# Architecture pillars


Unless stated otherwise, the hardware acceleration terminology used in this document follows the OpenCL nomenclature ([^6],[^7]) for hardware acceleration. Hardware acceleration commercial solutions are also called *accelerators*. The proposed architecture in this REP is depicted below:

> 除非另有说明，本文档中使用的硬件加速术语遵循OpenCL的命名法（[^6]，[^7]）。硬件加速商业解决方案也称为*加速器*。本REP提出的架构如下图所示：

::: {#architecture}
ROS 2 stack         Hardware Acceleration Architecture @ ROS 2 stack

```
+-----------+          +-------------------------------------------------+
|           |          |                 acceleration_examples           |
|user land  | +-----------------+-----------------------------------+----------+
|           | |     Drivers     |            Libraries              | Firmware |
+-----------+ +-------------------------------+-+-------------------------+----+
|           | | ament_vitis | ament_rocm | ...  |                   |     |    |
|           | +-----------------------------------------------------+ fw_1|fw_2|
| tooling   | |   ament_hardware_acceleration   |  colcon_hw_accel  |     |    |
|           | +-----------------------------------------------------------+----+
|           | |           build system          |    meta build     | firmware |
+-----------+ +------------------+--------------+-------------------+-+--------+
|    rcl    |                    |                                    |         
+-----------+                    |                                    |         
|    rmw    |                    |                                    |         
+-----------+                    +                                    +         
|rmw_adapter|                  Pillar I                            Pillar II
+-----------+
```

:::

## Pillar I - Extensions to ament {#pillarI}


The first pillar represents extensions of the `ament` ROS 2 build system. These CMake extensions help achieve the objective of simplifying the creation of acceleration kernels. By providing an experience and a syntax similar to other ROS 2 libraries targeting CPUs, maintainers will be able to integrate acceleration kernels into their packages easily. The [ament_hardware_acceleration](https://github.com/ros-acceleration/ament_hardware_acceleration/) ROS 2 package abstracts the build system extensions from technology-specific frameworks and software platforms. This allows to easily support hardware acceleration across FPGAs and GPUs while using the same syntax, simplifying the work of maintainers. The code listing below provides an example that instructs the `CMakeLists.txt` file of a ROS 2 package to build a `vadd` acceleration kernel indicating the corresponding sources without the need to define a target accelerator:

> 第一个支柱代表`ament`ROS 2构建系统的扩展。这些CMake扩展有助于实现简化创建加速内核的目标。通过提供针对CPU的其他ROS 2库类似的体验和语法，维护者将能够轻松地将加速内核集成到其包中。[ament_hardware_acceleration](https://github.com/ros-acceleration/ament_hardware_acceleration/)ROS 2包将构建系统扩展与技术特定的框架和软件平台相抽象。这允许使用相同的语法轻松支持FPGA和GPU的硬件加速，简化维护者的工作。下面的代码列表提供了一个示例，指示ROS 2包的`CMakeLists.txt`文件构建`vadd`加速内核，指示相应的源，而无需定义目标加速器：

```
acceleration_kernel(
  NAME vadd
  FILE src/vadd.cpp
  INCLUDE
    include
)
```


Under the hood, each specialization of `ament_hardware_acceleration` should rely on the corresponding frameworks, tools and libraries to enable building the acceleration kernel. For example, [ament_vitis](https://github.com/ros-acceleration/ament_vitis/) relies on Vitis Unified Software Platform (*Vitis* for short) to generate the appropriate acceleration kernels. The developer of such kernel would need to choose and implement how the CPU ROS abstractions (e.g. Nodes) would communicate with the acceleration kernel, if either through OpenCL or through the Xilinx Runtime (XRT) library, but that\'s abstracted away. In other words, the definition of the communication between the application code (ROS Node) and the acceleration kernels is decided by the developer and reflected in the source code of the Node. When using `ament_hardware_acceleration` macros such as `acceleration_kernel` , Vitis, OpenCL and XRT are completely hidden from the robotics engineer, simplifying the creation of kernels through simple CMake macros in the `CMakeLists.txt` file of the ROS package. If desired, the developer can express the same kernel using specializations `ament_hardware_acceleration`. In the case of `ament_vitis` , the developer can use the `vitis_acceleration_kernel` macro to express the same kernel as above, but with finer-grained details:

> 深入探究，每个`ament_hardware_acceleration`的特殊化应该依赖于相应的框架、工具和库来实现加速内核的构建。例如，[ament_vitis](https://github.com/ros-acceleration/ament_vitis/)依赖于Vitis统一软件平台（简称*Vitis*）来生成相应的加速内核。这样的内核的开发者需要选择和实现CPU ROS抽象（如节点）如何与加速内核通信，如通过OpenCL或通过Xilinx运行时（XRT）库，但这些都是抽象的。换句话说，应用程序代码（ROS节点）与加速内核之间的通信定义由开发者决定，并反映在节点的源代码中。当使用`ament_hardware_acceleration`宏（如`acceleration_kernel`）时，机器人工程师完全不用关心Vitis、OpenCL和XRT，只需在ROS包的`CMakeLists.txt`文件中简单使用CMake宏即可创建内核。如果需要，开发者可以使用特殊化`ament_hardware_acceleration`表达同样的内核。在`ament_vitis`的情况下，开发者可以使用`vitis_acceleration_kernel`宏来表达同样的内核，但更精细的细节。

```
vitis_acceleration_kernel(
  NAME vadd
  FILE src/vadd.cpp
  CONFIG src/kv260.cfg
  INCLUDE
    include
  TYPE
    sw_emu
    # hw_emu
    # hw
  PACKAGE
)
```


While `ament_hardware_acceleration` CMake macros are preferred and encouraged, maintainers are free to choose among all the CMake macros available within each of the specializalizations. After all, it\'ll be hard to define a generic set of macros that fits all use cases across technologies and silicon vendors. Maintainers are, however, encouraged to produce ROS packages that consider various accelerators. To do so, each extension of the `ament` ROS 2 build system for hardware acceleration purposes shall define *CMake hardware acceleration variables*. These variables are meant to be used by the maintainers to conditionally compile their ROS 2 packages for specific accelerators. The following table lists the variables defined by `ament_hardware_acceleration` and its specializalization `ament_vitis` for hardware acceleration purposes. Other specializalizations should follow along the same lines:

> 虽然建议使用`ament_hardware_acceleration` CMake 宏，但维护者可以在每个特定化方案中选择所有可用的CMake宏。毕竟，很难定义一套通用的宏以满足跨技术和芯片厂商的所有用例。但是，鼓励维护者生成考虑各种加速器的ROS软件包。为此，为硬件加速目的而扩展的`ament` ROS 2 构建系统应定义*CMake硬件加速变量*。这些变量旨在供维护者使用，以便有条件地为特定加速器编译其ROS 2 软件包。以下表列出了`ament_hardware_acceleration`及其特定化`ament_vitis`用于硬件加速目的而定义的变量。其他特定化应沿相同的方式进行：

---

`ament` ROS 2 build system extension                                                                          variable             description

---


[ament_hardware_acceleration](https://github.com/ros-acceleration/ament_hardware_acceleration/)               `ROS_ACCELERATION`   This CMake variable will evaluate to `True` when targeting *any* of the supported ROS 2-enabled accelerators (see `mixins` enablement below). Use while integrating acceleration kernels in a technology and vendor-agnostic manner.

> ROS_ACCELERATION：当目标为任何支持的ROS 2加速器（请参见下面的“混合”启用）时，此CMake变量将评估为“True”。 以任何技术和供应商无关的方式集成加速内核。


[ament_vitis](https://github.com/ros-acceleration/ament_vitis/) (specializes `ament_hardware_acceleration`)   `ROS_VITIS`          This CMake variable will evaluate to `True` when targeting ROS 2-enabled accelerators that use the Vitis platform for hardware acceleration.

> [ament_vitis](https://github.com/ros-acceleration/ament_vitis/)（专用于`ament_hardware_acceleration`）`ROS_VITIS`：当目标是使用Vitis平台进行硬件加速的ROS 2启用加速器时，此CMake变量将评估为`True`。
-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------


Through `ament_hardware_acceleration` and technology-specific specializations (like `ament_vitis`), the ROS 2 build system is automatically enhanced to support producing acceleration kernel and related artifacts as part of the build process when invoking `colcon build`. To facilitate the work of maintainers, this additional functionality is configurable through `mixins` that can be added to the build step of a ROS 2 workspace, triggering all the hardware acceleration logic only when appropriate (e.g. when `--mixin kv260` is appended to the build effort, it\'ll trigger the build of kernels targeting the KV260 hardware solution). For a reference implementation of these enhacements, refer to [ament_vitis](https://github.com/ros-acceleration/ament_vitis/).

> 通过`ament_hardware_acceleration`和特定技术的专业化（如`ament_vitis`），ROS 2构建系统自动增强，以支持在调用`colcon build`时作为构建过程的一部分生成加速内核和相关工件。为了方便维护人员的工作，此附加功能可以通过可以添加到ROS 2工作空间的构建步骤中的`mixins`来配置，仅在适当时触发所有硬件加速逻辑（例如，当向构建工作附加`--mixin kv260`时，它将触发针对KV260硬件解决方案的内核构建）。有关此增强功能的参考实现，请参阅[ament_vitis](https://github.com/ros-acceleration/ament_vitis/)。


In turn, additional extensions to the existing CMake macros might be proposed which would allow to support more technologies and hardware solutions. For example, `ament_vitis` provides a `vitis_acceleration_kernel` macro that can be used to generate kernels for the Xilinx Vitis platform. Similarly, `ament_rocm` could provide a `rocm_acceleration_kernel` macro that can be used to generate kernels for the AMD ROCm platform. This way, maintainers can choose to use the generic `acceleration_kernel` macro, or instead use the technology-specific macros to target specific hardware solutions. Also, future extensions to the `ament_hardware_acceleration` package could be proposed to support the use of accelerators in binary format instead of source builds. This would allow to support accelerators which are are not fully integrated into ROS 2 through their corresponding technology libraries (e.g. FPGAs that are not supported by Vitis).

> 反过来，可以提出针对现有CMake宏的额外扩展，以支持更多技术和硬件解决方案。例如，`ament_vitis`提供了一个`vitis_acceleration_kernel`宏，可用于为Xilinx Vitis平台生成内核。类似地，`ament_rocm`可以提供一个`rocm_acceleration_kernel`宏，用于为AMD ROCm平台生成内核。这样，维护者可以选择使用通用的`acceleration_kernel`宏，或者使用技术特定的宏来针对特定的硬件解决方案。此外，可以提出未来对`ament_hardware_acceleration`软件包的扩展，以支持以二进制格式使用加速器，而不是源代码构建。这将允许支持通过其相应技术库未完全集成到ROS 2中的加速器（例如，不受Vitis支持的FPGA）。

## Pillar II - firmware {#pillarII}


The second pillar is firmware, it is meant to provide firmware artifacts for each supported technology so that the kernels can be compiled against them, simplifying the process for consumers and maintainers, and further aligning with the ROS typical development flow.

> 第二个支柱是固件，它旨在为每种支持的技术提供固件工件，以便可以对其进行内核编译，简化消费者和维护者的流程，并进一步与ROS典型的开发流程保持一致。


Each ROS 2 workspace can have one or multiple firmware packages deployed. The selection of the active firmware in the workspace is performed by simlinking the preferred one or by using auxiliary tools that extend the `colcon` ROS 2 meta-build system (see the [colcon-hardware-acceleration](https://github.com/colcon/colcon-hardware-acceleration) ROS package and with it, the `colcon acceleration select` subverb). To get a technology solution aligned with this REP\'s architecture, each vendor should provide and maintain an `acceleration_firmware_<solution>` package specialization that delivers the corresponding artifacts. Firmware artifacts should be deployed at `<ros2_workspace_path>/acceleration/firmware/<solution>` and be ready to be used by the ROS 2 build system extensions at ([pillarI](#pillarI)) . For a reference implementation of specialized vendor firmware package, see [acceleration_firmware_kv260](https://github.com/ros-acceleration/acceleration_firmware_kv260).

> 每个ROS 2工作区可以部署一个或多个固件包。在工作区中选择活动固件的选择是通过链接所首选的固件或使用扩展ROS 2元构建系统`colcon`的辅助工具来完成的（请参阅[colcon-hardware-acceleration](https://github.com/colcon/colcon-hardware-acceleration)ROS包及其`colcon acceleration select`子动词）。为了获得与此REP架构对齐的技术解决方案，每个供应商应提供并维护一个`acceleration_firmware_<solution>`包特性，以提供相应的工件。固件工件应部署在`<ros2_workspace_path>/acceleration/firmware/<solution>`，并准备好由ROS 2构建系统扩展在（pillarI）中使用。有关特定供应商固件包的参考实现，请参见[acceleration_firmware_kv260](https://github.com/ros-acceleration/acceleration_firmware_kv260)。

By splitting vendors across packages, consumers and maintainers can easily switch between hardware acceleration solutions within the same workspace.

# Specification


A ROS 2 package supports hardware acceleration if it provides support for at least one of the *supported hardware acceleration commercial solutions* (or *accelerators*) that comply with this REP. An accelerator complies with this REP if it aligns with the open source [architecture](#architecture) for hardware acceleration proposed in this REP. The architecture proposed is composed of two pillars. The first one comprehends ROS 2 build system extensions (`ament`) to support various accelerators ([pillarI](#pillarI)) as build targets. The second one introduces firmware additions into ROS 2 workspaces ([pillarII](#pillarII)), which abstract away vendor-specific hardware acceleration frameworks, libraries and tools while building acceleration kernels for each technology/accelerator. An accelerator complying with this architecture should implement [pillarI](#pillarI) and [pillarII](#pillarII). `colcon` mixins are suggested as the triggering method for enabling `ament` build extensions. Given `accelerator_A` which implements the architecture through its two pillars, building ROS `package_1` for `accelerator_A` would look like this:

> 如果至少支持本REP中所列出的*受支持的硬件加速商业解决方案*（或*加速器*）之一，ROS 2 包就会支持硬件加速。如果加速器符合本REP中提出的开源[架构]（＃架构），则符合本REP。提出的架构由两个支柱组成。第一个涵盖ROS 2构建系统扩展（`ament`），以支持各种加速器（[pillarI]（＃pillarI））作为构建目标。第二个引入了ROS 2工作空间（[pillarII]（＃pillarII））中的固件附加功能，以抽象出供应商特定的硬件加速框架，库和工具，同时为每种技术/加速器构建加速内核。符合此架构的加速器应实施[pillarI]（＃pillarI）和[pillarII]（＃pillarII）。建议使用`colcon`混合物作为启用`ament`构建扩展的触发方法。给定实施该架构的两个支柱的`accelerator_A`，为`accelerator_A`构建ROS `package_1`的过程如下：

```
colcon build --mixin accelerator_A --packages-select package_1
```

Building the same package for another accelerator, `accelerator_B`, would look like this:

```
colcon build --mixin accelerator_B --packages-select package_1
```


Separating the build and install directories for each accelerator is encouraged as each would rely on different firmware and potentially different cross-compilers. This would allow to build and install ROS 2 packages for different accelerators in the same workspace.

> 在每个加速器上建立和安装不同的目录是受鼓励的，因为每个加速器都会依赖不同的固件和可能不同的交叉编译器。这将允许在同一工作空间中为不同的加速器构建和安装ROS 2软件包。

```
# build for accelerator_A
colcon build --merge-install --build-base=build-accelerator-A --install-base=install-accelerator-A --merge-install --mixin accelerator_A --packages-select package_1

# build for accelerator_B
colcon build --merge-install --build-base=build-accelerator-B --install-base=install-accelerator-B --merge-install --mixin accelerator_B --packages-select package_1
```


The architecture proposed in this REP is meant to be generic and technology-agnostic (including OS), so that it can be extended to support other hardware acceleration technologies and hardware solutions in the future while bringing value to all [stakeholders](#stakeholders). Silicon vendors and hardware solution manufacturers aiming to integrate their solutions in the ROS 2 ecosystem are encouraged to provide themselves their own technology-specific extensions to the ROS 2 build system ([pillarII](#pillarII)) and firmware packages ([pillarI](#pillarI)). This way, consumers and maintainers can easily adopt their technologies to build kernels, and switch between hardware acceleration solutions within the same ROS workspace.

> 本 REP 提出的架构旨在普遍通用且不受技术限制（包括操作系统），以便将来可以扩展以支持其他硬件加速技术和硬件解决方案，同时为所有[利益相关者](#stakeholders)带来价值。鼓励硅片供应商和硬件解决方案制造商将自己的技术特定扩展提供给 ROS 2 构建系统（[pillarII](#pillarII)）和固件包（[pillarI](#pillarI））。这样，消费者和维护人员可以轻松地采用他们的技术来构建内核，并在同一个ROS工作空间中切换硬件加速解决方案。


Package maintainers are encouraged to integrate hardware acceleration in their ROS 2 packages by using the *CMake hardware acceleration variables* and the `acceleration_kernel` CMake macro, or any of its specializations. These CMake macros are meant to be used by maintainers to conditionally compile their ROS 2 packages and acceleration kernels for those accelerators that implement the [architecture](#architecture). This would like like this on the package\'s `CMakeLists.txt`:

> 包维护者受鼓励使用*CMake硬件加速变量*和`acceleration_kernel` CMake宏，或其任何特殊化，在其ROS 2包中集成硬件加速。这些CMake宏旨在被维护者用于有条件地为实现[架构](#architecture)的加速器编译其ROS 2包和加速内核。这将在包的`CMakeLists.txt`上看起来像这样：

```
find_package(ament_hardware_acceleration)
find_package(ament_vitis QUIET)

if(ROS_VITIS)  # e.g. well tested acceleration kernel with a 100 MHz clock
               # and a configuration that is known to work well
  vitis_acceleration_kernel(
    NAME my_acceleration_kernel
    FILE my_acceleration_kernel.cpp
    CONFIG config.cfg
    CLOCK 100000000:my_kernel_main
    INCLUDE
      include
    TYPE
      hw
    LINK
    PACKAGE
  )
elseif(ROS_ACCELERATION)  # best effort acceleration kernel for the supported
                          # (and targeted, via mixins) accelerator
  acceleration_kernel(
    NAME my_acceleration_kernel
    FILE my_acceleration_kernel.cpp
    INCLUDE
      include
  )
endif()  # ROS_VITIS, ROS_ACCELERATION

ament_package()
```


To further support package maintainers and consumers, this REP also proposes a methodology to analyze a ROS 2 application and integrate hardware acceleration. Developers are encouraged to follow this methodology while developing acceleleration kernels. Examples demonstrating the use of this methodology for hardware acceleration are available in[^8] and[^9].

> 为了进一步支持软件包维护者和消费者，本REP还提出了一种分析ROS 2应用并集成硬件加速的方法。开发人员可以在开发加速内核时遵循此方法。使用此方法实现硬件加速的示例可在[^8]和[^9]中找到。

## Methodology for developing ROS 2 packages that integrate hardware acceleration

```
rebuild

+---------------+
|               |
|               |
|4. benchmark   +--+
|   acceleration|  |
+-->               |  |
|  +---------------+  |
|                     | acceleration
|                     | tracing
trace dataflow              |                     |
+--------------+             |   +---------------+ |
|              |             +---+               +<+
+------------v---+ +--------v-------+         |               |
|                | |                |         |               |
| 3.2 accelerate | | 3.1 accelerate <---------> 3. hardware   |
|     graph      | |     nodes      |  trace  |  acceleration |
|                | |                |  nodes  |               <-+
+----------------+ +----------------+         |               | |
+---------------+ |
              |
              | CPU
              | tracing
+--------------+  |
+----------------+  rebuild |              |  |
|                +---------->              |  |
start  +----------> 1. trace graph |          | 2. benchmark +--+
|                |          |    CPU       |
+----+------^--^-+          |              |
|      |  |            +-------+------+
|      |  |                    |
+------+  |                    |
Tracer   +--------------------+
re-instrument
```

This can be summarized as follows:


- 1. instrument the core components of a ROS 2 application using a tracing framework and trace its execution to obtain information about its time bottlenecks. Refer to REP-2014 for guidelines on tracing and benchmarking performance in ROS 2, including examples of tracing frameworks and how to use them.

> 在ROS 2应用程序的核心组件上使用追踪框架进行检测，并追踪其执行以获取其时间瓶颈的信息。请参阅REP-2014，了解ROS 2中追踪和基准测试性能的指南，包括追踪框架的示例以及如何使用它们。

- 2. trace, benchmark and analyze the ROS 2 application on the CPU to establish a compute baseline; Determine which functions are subject to be hardware accelerated.

> 追踪、基准测试和分析ROS 2应用程序在CPU上，建立计算基线；确定哪些功能可以硬件加速。
- 3. develop a hardware acceleration kernels for those functions identified before, and optimize the dataflow across Nodes

  > - 3.1 accelerate computations at the Node or Component level for each one of those functions identified in 2. as good candidates.

  > - 3.2 accelerate inter-Node exchanges and reduce the overhead of the ROS 2 message-passing system across all its abstraction layers. To do so, consider leveraging REP-2007 and REP-2009.

> 加速节点间的交换，减少ROS 2消息传递系统在所有抽象层面上的开销。为此，考虑利用REP-2007和REP-2009。
  >

- 4. trace, benchmark and analyze the ROS 2 application including the acceleration kernels and compare against the CPU baseline obtained in 2. to determine the performance improvement. Re-iterate 3. and 4. until the desired performance is achieved.

> 跟踪、基准测试和分析ROS 2应用程序，包括加速内核，并与第2步获得的CPU基线进行比较，以确定性能改进。重复第3步和第4步，直到达到预期的性能为止。

Additional about tracing and benchmarking are beyond the scope of this REP. For more details about tracing and benchmarking, see REP-2014.

## Acceleration examples {#acceleration examples}


For the sake of illustrating maintainers and consumers how to build their own acceleration kernels and guarantee interoperability across technologies, a ROS 2 meta-package named [acceleration_examples](https://github.com/ros-acceleration/acceleration_examples) will be maintained and made available. This meta-package will contain various packages with simple common acceleration examples. Each one of these examples should aim to support all hardware acceleration solutions complying with this REP.

> 为了演示维护者和使用者如何构建自己的加速内核，并保证不同技术之间的互操作性，将维护并发布一个名为[acceleration_examples]（https://github.com/ros-acceleration/acceleration_examples）的ROS 2元包。该元包将包含各种具有简单常见加速示例的包。每个示例都应支持符合该REP的所有硬件加速解决方案。

# Backwards Compatibility

The proposed features and conventions add new functionality while not modifying existing functionality.

# Reference Implementation and recommendations


Reference implementations complying with this REP and extending the ROS 2 build system and tools for hardware acceleration are available at the [Hardware Accelerationg WG GitHub organization](https://github.com/ros-acceleration). This includes also the abstraction layer [ament_hardware_acceleration](https://github.com/ros-acceleration/ament_hardware_acceleration/) and firmware from vendor specializalizations like [ament_vitis](https://github.com/ros-acceleration/ament_vitis/). A paper describing in more detail the reference implementation is available at[^10].

> 参考实现符合本REP，并扩展了ROS 2构建系统和硬件加速工具，可在[硬件加速WG GitHub组织](https://github.com/ros-acceleration)获取。这还包括抽象层[ament_hardware_acceleration](https://github.com/ros-acceleration/ament_hardware_acceleration/)和供应商专业化的固件，如[ament_vitis](https://github.com/ros-acceleration/ament_vitis/)。有关参考实现的更详细描述，请参阅[^10]。


`colcon` ROS 2 meta built tools can be extended to help integrate hardware acceleration flows into the ROS 2 CLI tooling. Examples of these extensions include emulation capabilities to speed-up the development process and/or facilitate it without access to the real hardware, or raw image production tools, which are convenient when packing together acceleration kernels for embedded targets. A reference implementation of these extensions is implemented at the [colcon-hardware-acceleration]() ROS 2 package, which is available in the buildfarm. Refer to the package for more details on its capabilities.

> colcon ROS 2元构建工具可以扩展以帮助将硬件加速流程集成到ROS 2 CLI工具中。这些扩展的示例包括模拟功能，以加快开发过程并/或在没有访问真实硬件的情况下进行辅助，或者原始图像生成工具，当将加速内核打包到嵌入式目标时非常方便。这些扩展的参考实现在[colcon-hardware-acceleration]() ROS 2软件包中实现，该软件包可在buildfarm中获得。有关其功能的更多详细信息，请参阅该软件包。


For additional implementations and recommendations, check out the [Hardware Accelerationg WG GitHub organization](https://github.com/ros-acceleration).

> 为了获得更多的实现和建议，请查看[硬件加速WG GitHub组织](https://github.com/ros-acceleration)。

## Template for Vendors


Silicon vendors and solution manufacturers can help set the expectations of the level of support their hardware acceleration technology provides in alignment with this REP by providing a template in the README.md files of their `firmware` and/or `ament` extensions. Doing so will facilitate the process for consumers and maintainers.

> 硅物料供应商和解决方案制造商可以通过在其固件和/或Ament扩展的README.md文件中提供模板，以帮助将其硬件加速技术提供的支持水平的期望与此REP保持一致。这样做将有助于消费者和维护者的流程。


For a **Markdown** syntax example of such template, refer to [acceleration_firmware_kr260](https://github.com/ros-acceleration/acceleration_firmware_kr260#hardware-acceleration-capabilities).

> 对于这种模板的**Markdown**语法示例，请参阅[acceleration_firmware_kr260](https://github.com/ros-acceleration/acceleration_firmware_kr260#hardware-acceleration-capabilities)。

# References and Footnotes

# Copyright

This document is placed in the public domain or under the CC0-1.0-Universal license, whichever is more permissive.


[^1]: Z. Wan, B. Yu, T. Y. Li, J. Tang, Y. Zhu, Y. Wang, A. Raychowdhury, and S. Liu, "A survey of fpga-based robotic computing," IEEE Circuits and Systems Magazine, vol. 21, no. 2, pp. 48--74, 2021.

> Z. Wan, B. Yu, T. Y. Li, J. Tang, Y. Zhu, Y. Wang, A. Raychowdhury 和 S. Liu，《基于FPGA的机器人计算综述》，IEEE电路与系统杂志，第21卷第2期，页48-74，2021年。



[^2]: Mayoral-Vilches, V., & Corradi, G. (2021). \"Adaptive computing in robotics, leveraging ros 2 to enable software-defined hardware for fpgas\". [https://www.xilinx.com/support/documentation/white_papers/wp537-adaptive-computing-robotics.pdf](https://www.xilinx.com/support/documentation/white_papers/wp537-adaptive-computing-robotics.pdf)

> Mayoral-Vilches, V. 和 Corradi, G. (2021). “机器人中的自适应计算，利用ROS 2为FPGA提供软件定义硬件”。[https://www.xilinx.com/support/documentation/white_papers/wp537-adaptive-computing-robotics.pdf](https://www.xilinx.com/support/documentation/white_papers/wp537-adaptive-computing-robotics.pdf)



[^3]: Mayoral-Vilches, V. (2021). \"Kria Robotics Stack\". [https://www.xilinx.com/content/dam/xilinx/support/documentation/white_papers/wp540-kria-robotics-stack.pdf](https://www.xilinx.com/content/dam/xilinx/support/documentation/white_papers/wp540-kria-robotics-stack.pdf)

> [^3]: Mayoral-Vilches，V（2021）。“Kria Robotics Stack”。[https://www.xilinx.com/content/dam/xilinx/support/documentation/white_papers/wp540-kria-robotics-stack.pdf](https://www.xilinx.com/content/dam/xilinx/support/documentation/white_papers/wp540-kria-robotics-stack.pdf)

[^3]: Mayoral-Vilches，V（2021）。“Kria Robotics Stack”。[https://www.xilinx.com/content/dam/xilinx/support/documentation/white_papers/wp540-kria-robotics-stack.pdf](https://www.xilinx.com/content/dam/xilinx/support/documentation/white_papers/wp540-kria-robotics-stack.pdf) 。



[^4]: Y. Yang and T. Azumi, "Exploring real-time executor on ros 2,". 2020 IEEE International Conference on Embedded Software and Systems (ICESS). IEEE, 2020, pp. 1--8.

> Y. Yang 和 T. Azumi，《探索ROS 2上的实时执行器》，2020年IEEE国际嵌入式软件和系统会议（ICESS），IEEE，2020，页1-8。



[^5]: C. Lienen and M. Platzner, "Design of distributed reconfigurable robotics systems with reconros," 2021. [https://arxiv.org/pdf/2107.07208.pdf](https://arxiv.org/pdf/2107.07208.pdf)

> C. Lienen 和 M. Platzner，“使用Reconros设计分布式可重构机器人系统”，2021年。[https://arxiv.org/pdf/2107.07208.pdf](https://arxiv.org/pdf/2107.07208.pdf)



[^6]: OpenCL 1.2 API and C Language Specification (November 14, 2012). [https://www.khronos.org/registry/OpenCL/specs/opencl-1.2.pdf](https://www.khronos.org/registry/OpenCL/specs/opencl-1.2.pdf)

> [^6]: OpenCL 1.2 API和C语言规范（2012年11月14日）。[https://www.khronos.org/registry/OpenCL/specs/opencl-1.2.pdf](https://www.khronos.org/registry/OpenCL/specs/opencl-1.2.pdf)



[^7]: OpenCL 1.2 Reference Pages. [https://www.khronos.org/registry/OpenCL/sdk/1.2/docs/man/xhtml/](https://www.khronos.org/registry/OpenCL/sdk/1.2/docs/man/xhtml/)

> [^7]: 参考页面：OpenCL 1.2。[https://www.khronos.org/registry/OpenCL/sdk/1.2/docs/man/xhtml/](https://www.khronos.org/registry/OpenCL/sdk/1.2/docs/man/xhtml/)



[^8]: \"Methodology for ROS 2 Hardware Acceleration\". ros-acceleration/community #20. ROS 2 Hardware Acceleration Working Group. [https://github.com/ros-acceleration/community/issues/20](https://github.com/ros-acceleration/community/issues/20)

> [^8]:“ROS 2硬件加速的方法”。ros-acceleration/社区#20. ROS 2硬件加速工作组。[https://github.com/ros-acceleration/community/issues/20](https://github.com/ros-acceleration/community/issues/20)



[^9]: Acceleration Robotics, \"Hardware accelerated ROS 2 pipelines and towards the Robotic Processing Unit (RPU)\". [https://news.accelerationrobotics.com/hardware-accelerated-ros2-pipelines/](https://news.accelerationrobotics.com/hardware-accelerated-ros2-pipelines/)

> 加速机器人技术：“硬件加速ROS 2管道和朝向机器人处理单元（RPU）”。[https://news.accelerationrobotics.com/hardware-accelerated-ros2-pipelines/](https://news.accelerationrobotics.com/hardware-accelerated-ros2-pipelines/)



[^10]: Mayoral-Vilches, V., Neuman, S. M., Plancher, B., & Reddi, V. J. (2022). \"RobotCore: An Open Architecture for Hardware Acceleration in ROS 2\". [https://arxiv.org/pdf/2205.03929.pdf](https://arxiv.org/pdf/2205.03929.pdf)

> Mayoral-Vilches, V., Neuman, S. M., Plancher, B. 和 Reddi, V. J. (2022). “RobotCore：ROS 2 硬件加速的开放式体系结构”。[https://arxiv.org/pdf/2205.03929.pdf](https://arxiv.org/pdf/2205.03929.pdf)
